
<!--
  Library of Code sp-us | Department of Engineering
  Originally written by: Matthew, AD, FSEN <matthew@staff.libraryofcode.org>
  Modified by: TheGreench, AS, ENG-I <greench@staff.libraryofcode.org>
    COPYRIGHT 2020
-->

<!DOCTYPE html>
<head lang="en">
    <title>Community Score Report</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="icon" type="image/png" href="https://static.libraryofcode.org/library_of_code_comm_red.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script>
      function visible(id) {
        document.getElementById(id).style.display = "block";
      }
      function invisible(id) {
        document.getElementById(id).style.display = "none";
      }
      async function offer() {
        const code = document.getElementById('offer').value;
        if (!code) return visible('invalidKey');
        const url = `https://loc.sh/int/offer/?code=${code}`;

        const fetched = await fetch(url);
        const accessDenied = 'Your access to this service has been denied.\nYou can access every 30 minutes.';
        if (fetched.status === 400 || fetched.status === 401 || fetched.status === 403 || fetched.status === 429) return visible('paKDenied');
        if (fetched.status >= 500) return visible('serviceE');
        invisible('pre');
        visible('offer-accepted');
        alert('This offer has been accepted, you may now close this tab.');
      }
      async function submit() {
        const pin1 = document.getElementById('pin1').value;
        if (!pin1 || pin1.length < 3 || pin1.length > 3) return visible('invalidPIN');
        const pin2 = document.getElementById('pin2').value;
        if (!pin2 || pin2.length < 2 || pin2.length > 2) return visible('invalidPIN');
        const pin3 = document.getElementById('pin3').value;
        if (!pin3 || pin3.length < 4 || pin3.length > 4) return visible('invalidPIN');
        let url = `https://loc.sh/int/score/?pin=${pin1}-${pin2}-${pin3}`;
        const staffPin1 = document.getElementById('staff-pin1').value;
        const staffPin2 = document.getElementById('staff-pin2').value;
        const staffPin3 = document.getElementById('staff-pin3').value;
        const combinedStaff = staffPin1 + staffPin2 + staffPin3;
        if (combinedStaff && combinedStaff.length === 9) url += `&staff=${staffPin1}-${staffPin2}-${staffPin3}`;
        const fetched = await fetch(url);
        const accessDenied = 'Your access to this service has been denied.\nYou can access every 30 minutes.';
        // if (fetched.status === 400 || fetched.status === 401 || fetched.status === 403 || fetched.status === 429) return alert(accessDenied);
        if (fetched.status === 400 || fetched.status === 401 || fetched.status === 403 || fetched.status === 429) return visible('denied');
        if (fetched.status >= 500) return visible('serviceE');
        const data = await fetched.json();
        invisible('pre');
        document.getElementById('lastUpdated').innerHTML = `<strong>Last updated:</strong> <span class="ScoreColorP">${new Date(data.lastUpdated).toLocaleString('en-us')}</span>`;
        document.getElementById('name').innerHTML = `<strong>Name:</strong> <span class="ScoreColorP">${data.name}</span>`;
        document.getElementById('id').innerHTML = `<strong>ID:</strong> <span class="ScoreColorP">${data.userID}</span>`;
        document.getElementById('pin').innerHTML = `<strong>PIN:</strong> <span class="ScoreColorP">${data.pin}</span>`;
        document.getElementById('total').innerHTML = `<strong>[-] Community Score:</strong> <span class="ScoreColorP">${data.score}</span>`;
        document.getElementById('activity').innerHTML = `<strong>[-] Activity:</strong> <span class="ScoreColorP">${data.activityScore}</span>`;
        document.getElementById('roles').innerHTML = `<strong>[-] Roles:</strong> <span class="ScoreColorP">${data.roleScore}</span>`;
        document.getElementById('moderation').innerHTML = `<strong>[-] Moderation:</strong> <span class="ScoreColorP">${data.moderationScore}</span>`;
        document.getElementById('cs').innerHTML = `<strong>[-] Cloud Services:</strong> <span class="ScoreColorP">${data.cloudServicesScore}</span>`;
        document.getElementById('other').innerHTML = `<strong>[-] Other:</strong> <span class="ScoreColorP">${data.otherScore}</span>`;
        document.getElementById('misc').innerHTML = `<strong>[-] Misc:</strong> <span class="ScoreColorP">${data.miscScore}</span>`;

        const hard = document.getElementById('hard');
        for (const pull of data.inquiries.sort((a, b) => b.date > a.date)) {
          const row = hard.insertRow();
          row.insertCell().innerHTML = pull.name.toUpperCase();
          row.insertCell().innerHTML = pull.reason;
          row.insertCell().innerHTML = new Date(pull.date).toLocaleString('en-us');
          document.getElementById('hardCount').innerHTML = `<span class="ScoreColorP">${data.inquiries.length}</span>`;
        }
        const soft = document.getElementById('soft');
        for (const pull of data.softInquiries.sort((a, b) => b.date > a.date)) {
          const row = soft.insertRow();
          row.insertCell().innerHTML = pull.name.toUpperCase();
          row.insertCell().innerHTML = new Date(pull.date).toLocaleString('en-us');
          document.getElementById('softCount').innerHTML = `<span class="ScoreColorP">${data.softInquiries.length}</span>`;
        }
        visible('post');
      }
    </script>
    <style>
        body {
          padding: 25px;
          background-color: white;
          color: #000000;
          --scoreColorP: #2800db;
        }
        .dark-mode {
          background-color: #3f3e3e;
          color: white;
          --enterB-bg: #232429;
          --enterBBorder-bg: white;
          --enterB-color: white;
          --scoreColorP: #dbcc00;
        }
        #pre, #post {
            margin: 35px;
        }
        #pre .headerH1 {
            text-decoration: underline;
        }
        #HASH {
            display: flex;
            justify-content: space-between;
        }
        .ScoreColorP {
            color: var(--scoreColorP);
        }
        #enterB {
          background-color: var(--enterB-bg);
          border-color: var(--enterBBorder-bg);
          color: var(--enterB-color);
        }
        #enterB:hover {
            background-color: green;
        }
        .modal-content {
          border: 1px solid rgb(223, 0, 0);
        }
        #closeBtn {
          background-color: red;
          border-color: none !important;
        }
        #closeBtn:hover {
          background-color: green;
          border-color: none !important;
        }
    </style>
</head>
<body>
    <!-- Main Div -->
    <div class="container-fluid" id="page-container">
        <!-- Body Div -->
        <div id="content-wrap">
            <!-- Verification Page Div -->
            <div id="pre">
                <div class="header" id="HASH">
                    <div>
                        <h2 class="headerH1">Library of Code sp-us</h2>
                        <p>You are preparing to view your score report. You can only make a request every 30 minutes, make sure your PIN is correct!</p>
                    </div>
                    <img src="https://static.libraryofcode.org/library_of_code_comm_red.png" height="75px" width="75px">
                </div>
                <hr class="my-4">
                <br><br>
                <!-- Personal PIN -->
                <div class="container-fluid" id="pre-two">
                    <h4>Personal PIN</h4>
                    <p>You can get your PIN by running <strong>?score</strong> in your DMs with the Library of Code sp-us bot.</p>
                    <div class="input-group mb-3">
                        <input id="pin1" type="text" class="form-control col-md-3" placeholder="XXX" aria-label="pin" aria-describedby="basic-addon" maxlength="3">
                        <!-- - -->
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon">-</span>
                        </div>
                        <input id="pin2" type="text" class="form-control col-md-2" placeholder="XX" aria-label="pin" aria-describedby="basic-addon2" maxlength="2">
                        <!-- - -->
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon2">-</span>
                        </div>
                        <input id="pin3" type="text" class="form-control col-md-3" placeholder="XXXX" aria-label="pin" aria-describedby="basic-addon3" maxlength="4">
                        <!-- Submit Personal Pin -->
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="submit" onclick="js:submit()" id="enterB">Enter</button>
                        </div>
                    </div>
                </div>
                <!-- Staff PIN -->
                <div class="container-fluid" id="pre-two">
                    <br><br>
                    <h4>Staff PIN</h4>
                    <p>If you're a Staff member and you are pulling a report for another user, please enter your PIN here.</p>
                    <div class="input-group mb-3">
                        <input id="staff-pin1" type="text" class="form-control col-md-3" placeholder="XXX" aria-label="pin" aria-describedby="basic-addon" maxlength="3">
                        <!-- - -->
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon1">-</span>
                        </div>
                        <input id="staff-pin2" type="text" class="form-control col-md-2" placeholder="XX" aria-label="pin" aria-describedby="basic-addon2" maxlength="2">
                        <!-- - -->
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon2">-</span>
                        </div>
                        <input id="staff-pin3" type="text" class="form-control col-md-3" placeholder="XXXX" aria-label="pin" aria-describedby="basic-addon3" maxlength="4">
                        <fieldset disabled>
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="submit" id="disabledTextInput" id="enterB" data-toggle="tooltip" data-placement="right" title="Disabled">Enter</button>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <!-- Pre Approval Key -->
                <div class="container-fluid" id="pre-two">
                    <br><br>
                    <h4>Pre-Approval Offer Accept <span class="badge badge-secondary" style="background-color: blueviolet;">New</span></h4>
                    <p>If you've received a pre-approved offer in your DMs and you wish to accept, please enter it here and hit enter. By entering your offer ID, you understand a hard pull will be performed on your Community Report. While your chances of being approved for a pre-approved offer are higher, it's not 100%.</p>
                    <div class="input-group mb-3">
                        <input id="offer" type="text" class="form-control col-md-10" placeholder="Insert Offer Code" aria-label="pin" aria-describedby="basic-addon3">
                        <!-- Submit Pre-Approval -->
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="submit" onclick="js:offer()" id="enterB">Enter</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pre Approval Message -->
            <div id="offer-accepted" style="display: none">
                <h3 id="offer-accepted" style="display: none">Offer Accepted</h3>
                <p id="offer-accepted" style="display: none">This offer has been accepted, you may now close this tab.</p>
            </div>

            <!-- Modal Denied -->
            <div class="modal" tabindex="-1" role="dialog" style="display: none" id="denied">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">ERROR: Access Denied</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="js:invisible('denied') && visible('pre')">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <p>Your access to this service has been denied.<br>You can access every 30 minutes.</p>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="js:invisible('denied') && visible('pre')" id="closeBtn">Close</button>
                    </div>
                  </div>
                </div>
            </div>

            <!-- PA Key Denied -->
            <div class="modal" tabindex="-1" role="dialog" style="display: none" id="paKDenied">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">ERROR: Access Denied</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="js:invisible('paKDenied') && visible('pre')">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <p>The Key you provided is invalid.</p>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="js:invisible('paKDenied') && visible('pre')" id="closeBtn">Close</button>
                    </div>
                  </div>
                </div>
            </div>

            <!-- Invalid PIN -->
            <div class="modal" tabindex="-1" role="dialog" style="display: none" id="invalidPIN">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">ERROR: Access Denied</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="js:invisible('invalidPIN') && visible('pre')">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <p>The Personal Indentification Number (PIN) you provided is invalid.</p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="js:invisible('invalidPIN') && visible('pre')" id="closeBtn">Close</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Invalid Key -->
            <div class="modal" tabindex="-1" role="dialog" style="display: none" id="invalidKey">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">ERROR: Access Denied</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="js:invisible('invalidKey') && visible('pre')">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <p>You must supply an Offer Code to continue.</p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="js:invisible('invalidKey') && visible('pre')" id="closeBtn">Close</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- 500 Service Modal -->
            <div class="modal" tabindex="-1" role="dialog" style="display: none" id="serviceE">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">ERROR: Server Error</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="js:invisible('serviceE') && visible('pre')">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <p>The service is currently experiencing issues processing, please try again later.</p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="js:invisible('serviceE') && visible('pre')" id="closeBtn">Close</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- User Page Div-->
            <div id="post" style="display: none">
                    <!-- Head -->
                    <div class="header" id="HASH">
                        <div>
                            <h2 class="headerH1">Library of Code sp-us | Community Report</h2>
                            <p>This information is confidential and only for authorized use.</p>
                        </div>
                        <img src="https://static.libraryofcode.org/library_of_code_comm_red.png" height="75px" width="75px">
                    </div>
                    <hr class="my-4">
                    <br>
                    <!-- Personal Info Box-->
                    <h4>Personal Information</h4>
                    <div style="padding: 8px; display: block; border: 1px solid black;">
                        <p id="name"></p>
                        <p id="id"></p>
                        <p id="pin"></p>
                    </div>
                    <br>
                    <!-- Score Box -->
                    <h4>Score</h4>
                    <p id="lastUpdated"></p>
                    <div style="padding: 8px; display: block; border: 1px solid black;">
                        <p id="total"></p>
                        <p id="activity"></p>
                        <p id="roles"></p>
                        <p id="moderation"></p>
                        <p id="cs"></p>
                        <p id="other"></p>
                        <p id="misc"></p>
                    </div>
                    <br>
                    <!-- Hard Pulls Table -->
                    <h4>Hard Inquiries | <span id="hardCount"></span> | <span><a class="btn btn-secondary btn-sm" data-toggle="collapse" href="#Collapse1" role="button" aria-expanded="false" aria-controls="Collapse1">Toggle Hard Inquiries</a></span></h4>
                    <p>All your inquiries will be labeled here, regardless of their age. They will stop impacting your score after 3 months.</p>
                    <div class="row">
                      <div class="col">
                        <div class="collapse multi-collapse" id="Collapse1">
                          <div class="card card-body">
                            <table class="table table-bordered table-striped" id="hard">
                              <thead class="thead-light">
                                  <tr>
                                      <th scope="col"><strong>Department/Service</strong></th>
                                      <th scope="col"><strong>Reason</strong></th>
                                      <th scope="col"><strong>Date</strong></th>
                                  </tr>
                              </thead>
                          </table>
                          </div>
                        </div>
                      </div>
                    </div>
                    <br>
                    <!-- Soft Pulls Table -->
                    <h4>Soft Inquiries | <span id="softCount"></span> | <span><a class="btn btn-secondary btn-sm" data-toggle="collapse" href="#Collapse2" role="button" aria-expanded="false" aria-controls="Collapse2">Toggle Soft Inquiries</a></span></h4>
                    <p>Soft Inquiries are pulls initiated by Staff members or even yourself to re-evaluate existing eligibility or just to check the report for informational purposes. Soft Inquiries will not count in your Community Score.</p>
                    <div class="row">
                      <div class="col">
                        <div class="collapse multi-collapse" id="Collapse2">
                          <div class="card card-body">
                            <table class="table table-bordered table-striped" id="soft">
                              <thead class="thead-light">
                                  <tr>
                                      <th scope="col"><strong>Department/Service or Name</strong></th>
                                      <th scope="col"><strong>Date</strong></th>
                                  </tr>
                              </thead>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
            </div>
        </div>

          <!-- Footer -->
        <br><br>
        <footer class="text-center font-weight-light text-monospace" id="footer">
              LIBRARY OF CODE SP-US | DEPT. OF COMMUNITY ENGAGEMENT & ENGINEERING
              <br>
              <a href="https://loc.sh/discord">Discord Server</a> | <a href="//libraryofcode.org">Main Web</a> | <a href="https://loc.sh/support">Support</a> | <a href="///directory.libraryofcode.org">Staff Directory</a> 
              <br>
              FOR AUTHORIZED USE ONLY
              <br>
              <br>
              <button onclick="myFunction()" class="btn btn-secondary btn-sm">Toggle dark mode</button>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script>
      $(document).ready(function() {
        $('[data-toggle="toggle"]').change(function(){
          $(this).parents().next('.hide').toggle();
        });
      });
    </script>
    <script>
      function myFunction() {
         var element = document.body;
         element.classList.toggle("dark-mode");
      }
    </script>
  </body>
